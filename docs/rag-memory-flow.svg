<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 880">
  <defs>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&amp;display=swap');
      .title { font-family: 'Noto Sans SC', sans-serif; font-size: 22px; font-weight: 700; fill: #1a1a2e; }
      .section-title { font-family: 'Noto Sans SC', sans-serif; font-size: 16px; font-weight: 700; fill: #16213e; }
      .step-title { font-family: 'Noto Sans SC', sans-serif; font-size: 13px; font-weight: 700; fill: #0f3460; }
      .step-desc { font-family: 'Noto Sans SC', sans-serif; font-size: 11px; fill: #533483; }
      .box-bg { fill: #f8f9fa; stroke: #7b2cbf; stroke-width: 2; rx: 10; }
      .step-box { fill: #ffffff; stroke: #9d4edd; stroke-width: 1.5; rx: 6; }
      .step-box-dark { fill: #f0f0ff; stroke: #7b2cbf; stroke-width: 1.5; rx: 6; }
    </style>
    <marker id="arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <path d="M0,0 L8,4 L0,8" fill="none" stroke="#9d4edd" stroke-width="1.5"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="700" height="880" fill="#ffffff"/>

  <!-- Title -->
  <text x="350" y="35" text-anchor="middle" class="title">RAG è®°å¿†ç³»ç»Ÿå·¥ä½œæµç¨‹</text>

  <!-- Section 1: Data Source -->
  <g transform="translate(80, 60)">
    <rect x="0" y="0" width="540" height="85" class="box-bg"/>
    <text x="270" y="22" text-anchor="middle" class="section-title">ğŸ“š æ•°æ®æº</text>

    <rect x="35" y="38" width="220" height="35" class="step-box"/>
    <text x="145" y="53" text-anchor="middle" class="step-title">~/.javis/memory/</text>
    <text x="145" y="67" text-anchor="middle" class="step-desc">æ‰‹åŠ¨æ·»åŠ çš„è®°å¿†æ–‡ä»¶</text>

    <rect x="285" y="38" width="220" height="35" class="step-box"/>
    <text x="395" y="53" text-anchor="middle" class="step-title">conversations.md</text>
    <text x="395" y="67" text-anchor="middle" class="step-desc">è‡ªåŠ¨ä¿å­˜çš„å¯¹è¯è®°å½•</text>
  </g>

  <!-- Main Arrow 1 -->
  <line x1="350" y1="145" x2="350" y2="175" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Section 2: Index Pipeline -->
  <g transform="translate(80, 175)">
    <rect x="0" y="0" width="540" height="230" class="box-bg"/>
    <text x="270" y="22" text-anchor="middle" class="section-title">ğŸ”§ ç´¢å¼•æµæ°´çº¿</text>

    <!-- Step 1 -->
    <rect x="25" y="38" width="115" height="42" class="step-box-dark"/>
    <text x="82" y="55" text-anchor="middle" class="step-title">â‘  æ–‡ä»¶ç›‘æ§</text>
    <text x="82" y="71" text-anchor="middle" class="step-desc">watchdog</text>
    <text x="155" y="50" class="step-desc">ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œé˜²æŠ– 1.5s</text>
    <text x="155" y="65" class="step-desc">æ”¯æŒ Markdown æ–‡ä»¶</text>

    <!-- Step 2 -->
    <rect x="25" y="90" width="115" height="42" class="step-box-dark"/>
    <text x="82" y="107" text-anchor="middle" class="step-title">â‘¡ æ–‡æœ¬åˆ†å—</text>
    <text x="82" y="123" text-anchor="middle" class="step-desc">Chunker</text>
    <text x="155" y="102" class="step-desc">400 tokens/å—ï¼Œ80 tokens é‡å </text>
    <text x="155" y="117" class="step-desc">SHA-256 å“ˆå¸Œå»é‡</text>

    <!-- Step 3 -->
    <rect x="25" y="142" width="115" height="42" class="step-box-dark"/>
    <text x="82" y="159" text-anchor="middle" class="step-title">â‘¢ å‘é‡åµŒå…¥</text>
    <text x="82" y="175" text-anchor="middle" class="step-desc">Embedding</text>
    <text x="155" y="154" class="step-desc">OpenAI / Gemini / Local</text>
    <text x="155" y="169" class="step-desc">ç¼“å­˜ç›¸åŒæ–‡æœ¬ç»“æœ</text>

    <!-- Step 4 -->
    <rect x="25" y="194" width="115" height="28" class="step-box-dark"/>
    <text x="82" y="213" text-anchor="middle" class="step-title">â‘£ å­˜å‚¨</text>
    <text x="155" y="206" class="step-desc">memory_chunks (æ–‡æœ¬+å‘é‡)</text>
    <text x="155" y="221" class="step-desc">embedding_cache</text>
  </g>

  <!-- Main Arrow 2 -->
  <line x1="350" y1="405" x2="350" y2="435" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Section 3: Search Engine -->
  <g transform="translate(80, 435)">
    <rect x="0" y="0" width="540" height="160" class="box-bg"/>
    <text x="270" y="22" text-anchor="middle" class="section-title">ğŸ” æ··åˆæœç´¢å¼•æ“</text>

    <!-- Query -->
    <text x="270" y="48" text-anchor="middle" class="step-title">Query</text>
    <line x1="270" y1="52" x2="270" y2="68" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- Split -->
    <line x1="270" y1="62" x2="140" y2="62" stroke="#9d4edd" stroke-width="1.5"/>
    <line x1="270" y1="62" x2="400" y2="62" stroke="#9d4edd" stroke-width="1.5"/>
    <line x1="140" y1="62" x2="140" y2="72" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>
    <line x1="400" y1="62" x2="400" y2="72" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- Vector Search -->
    <rect x="70" y="72" width="140" height="38" class="step-box"/>
    <text x="140" y="90" text-anchor="middle" class="step-title">å‘é‡æœç´¢</text>
    <text x="140" y="104" text-anchor="middle" class="step-desc">ä½™å¼¦ç›¸ä¼¼åº¦</text>

    <!-- Keyword Search -->
    <rect x="330" y="72" width="140" height="38" class="step-box"/>
    <text x="400" y="90" text-anchor="middle" class="step-title">å…³é”®è¯æœç´¢</text>
    <text x="400" y="104" text-anchor="middle" class="step-desc">LIKE / FTS5</text>

    <!-- Merge -->
    <line x1="140" y1="110" x2="140" y2="125" stroke="#9d4edd" stroke-width="1.5"/>
    <line x1="400" y1="110" x2="400" y2="125" stroke="#9d4edd" stroke-width="1.5"/>
    <line x1="140" y1="125" x2="250" y2="125" stroke="#9d4edd" stroke-width="1.5"/>
    <line x1="400" y1="125" x2="290" y2="125" stroke="#9d4edd" stroke-width="1.5"/>
    <line x1="270" y1="125" x2="270" y2="135" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- Fusion -->
    <rect x="170" y="135" width="200" height="35" class="step-box-dark"/>
    <text x="270" y="152" text-anchor="middle" class="step-title">ç»“æœèåˆ: 70% + 30%</text>
    <text x="270" y="165" text-anchor="middle" class="step-desc">æœ€å°ç›¸å…³åº¦ â‰¥ 0.35ï¼ŒTop 6</text>
  </g>

  <!-- Main Arrow 3 -->
  <line x1="350" y1="595" x2="350" y2="625" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Section 4: Chat Application -->
  <g transform="translate(80, 625)">
    <rect x="0" y="0" width="540" height="180" class="box-bg"/>
    <text x="270" y="22" text-anchor="middle" class="section-title">ğŸ’¬ å¯¹è¯åº”ç”¨</text>

    <!-- Flow row 1 -->
    <g transform="translate(15, 40)">
      <rect x="0" y="0" width="85" height="30" class="step-box"/>
      <text x="42" y="19" text-anchor="middle" class="step-title">ç”¨æˆ·æ¶ˆæ¯</text>
    </g>
    <line x1="100" y1="55" x2="112" y2="55" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

    <g transform="translate(115, 40)">
      <rect x="0" y="0" width="85" height="30" class="step-box"/>
      <text x="42" y="19" text-anchor="middle" class="step-title">å‘é‡åµŒå…¥</text>
    </g>
    <line x1="200" y1="55" x2="212" y2="55" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

    <g transform="translate(215, 40)">
      <rect x="0" y="0" width="85" height="30" class="step-box"/>
      <text x="42" y="19" text-anchor="middle" class="step-title">æ··åˆæœç´¢</text>
    </g>
    <line x1="300" y1="55" x2="312" y2="55" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

    <g transform="translate(315, 40)">
      <rect x="0" y="0" width="85" height="30" class="step-box"/>
      <text x="42" y="19" text-anchor="middle" class="step-title">æ³¨å…¥ä¸Šä¸‹æ–‡</text>
    </g>
    <line x1="400" y1="55" x2="412" y2="55" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

    <g transform="translate(415, 40)">
      <rect x="0" y="0" width="70" height="30" class="step-box-dark"/>
      <text x="35" y="19" text-anchor="middle" class="step-title">LLM</text>
    </g>

    <!-- Flow row 2 -->
    <path d="M450 70 L450 85 L35 85 L35 98" fill="none" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

    <g transform="translate(15, 98)">
      <rect x="0" y="0" width="95" height="30" class="step-box"/>
      <text x="47" y="19" text-anchor="middle" class="step-title">ä¿å­˜å¯¹è¯æ‘˜è¦</text>
    </g>
    <line x1="110" y1="113" x2="122" y2="113" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

    <g transform="translate(125, 98)">
      <rect x="0" y="0" width="85" height="30" class="step-box"/>
      <text x="42" y="19" text-anchor="middle" class="step-title">è§¦å‘æ›´æ–°</text>
    </g>
    <line x1="210" y1="113" x2="222" y2="113" stroke="#9d4edd" stroke-width="1.5" marker-end="url(#arrow)"/>

    <g transform="translate(225, 98)">
      <rect x="0" y="0" width="85" height="30" class="step-box-dark"/>
      <text x="42" y="19" text-anchor="middle" class="step-title">ç´¢å¼•åŒæ­¥</text>
    </g>

    <!-- Loop back indicator -->
    <text x="380" y="115" class="step-desc" fill="#9d4edd">â†» æŒç»­å­¦ä¹ </text>
  </g>
</svg>
